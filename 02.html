


<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Регистрация (изменения) - ОРЦ</title>
    <link href="/orc/Content/themes/base/css?v=khU3GP_ixo8tMiLwXJEqkRywEE1c7SBpfpbj4KSDyXA1" rel="stylesheet"/>

    <link href="/orc/Content/css?v=VMXJOQATDkm80EqC4jb7uk4qUrYxXBGqSPMYahN8hJ41" rel="stylesheet"/>

    <script src="/orc/bundles/modernizr?v=inCVuEFe6J4Q07A0AcRsbJic_UE5MwpRMNGcOtk94TE1"></script>


    <link href="/orc/Content/select2.css" rel="stylesheet"/>


</head>
<body>
    <script type="text/javascript">
        if (window.FileReader && window.File && window.FileList && window.Blob && window.FormData) {
            document.body.className = 'jsok';
        }
    </script>

    <div id="scriptwarning">
        <div class="panel panel-danger">
            <div class="panel-heading"><span class="h1">Внимание!</span></div>
            <div class="panel-body lead">В вашем браузере отключена поддержка сценариев Javascript, или вы пользуетесь слишком старой версией браузера.</div>
        </div>
    </div>
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="row">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                        <a class="navbar-brand" href='/orc/ru-RU/Home/Dashboard'><span class="glyphicon glyphicon-info-sign changehistory-new-icon"></span> ОРЦ</a>
                </div>
                <div class="navbar-collapse collapse">
                    <ul class="nav navbar-nav">
                                <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Управление<span class="caret"></span></a>
            <ul class="dropdown-menu" role="menu">
                <li><a href="/orc/ru-RU/User">Управление пользователями</a></li>
            </ul>
        </li>
        <li><a href="/orc/ru-RU/Registration">Регистрация</a></li>
        <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Списки<span class="caret"></span></a>
            <ul class="dropdown-menu" role="menu">
                    <li><a href="/orc/ru-RU/Distributive">Список дистрибутивов</a></li>
                                    <li><a href="/orc/ru-RU/Kit">Список комплектов</a></li>
            </ul>
        </li>
        <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Обмен<span class="caret"></span></a>
            <ul class="dropdown-menu" role="menu">
                    <li class="dropdown-header" role="separator">
                        <i class="left-divider"></i>
                        <i class="glyphicon glyphicon-cloud-download"> Выгрузить CSV (OUTCSV):</i>
                        <i class="right-divider"></i>
                    </li>
                    <li class="dropdown dropdown-submenu">
                        <a href='#' class="dropdown-toggle" data-toggle="dropdown"><span class=""> Действующие</span></a>
                        <ul class="dropdown-menu">
                            <li><a href='/orc/api/v1/distributives/export?criterion=Valid&amp;version=0' class="fileDownloadPromise">версия 0</a></li>
                            <li><a href='/orc/api/v1/distributives/export?criterion=Valid&amp;version=1' class="fileDownloadPromise">версия 1</a></li>
                        </ul>
                    </li>
                    <li class="dropdown dropdown-submenu">
                        <a href='#' class="dropdown-toggle" data-toggle="dropdown"><span class=""> Действующие и теневые</span></a>
                        <ul class="dropdown-menu">
                            <li><a href='/orc/api/v1/distributives/export?criterion=All&amp;version=0' class="fileDownloadPromise">версия 0</a></li>
                            <li><a href='/orc/api/v1/distributives/export?criterion=All&amp;version=1' class="fileDownloadPromise">версия 1</a></li>
                        </ul>
                    </li>
                    <li class="dropdown dropdown-submenu">
                        <a href='#' class="dropdown-toggle" data-toggle="dropdown"><span class=""> Свободные ОДД</span></a>
                        <ul class="dropdown-menu">
                            <li><a href='/orc/api/v1/distributives/export?criterion=DEMFree&amp;version=0' class="fileDownloadPromise">версия 0</a></li>
                            <li><a href='/orc/api/v1/distributives/export?criterion=DEMFree&amp;version=1' class="fileDownloadPromise">версия 1</a></li>
                        </ul>
                    </li>
                                    <li role="separator" class="divider"></li>
                    <li id="csvimport-menu-item">
                        <a href='#' data-bind="click: StartUpload"><i class="glyphicon glyphicon-cloud-upload"></i> Загрузить CSV (INCSV)</a>
                        <input id="csvimport-menu-file-input" type="file" accept=".csv" data-url='/orc/api/v1/distributives/import' style="display:none" />
                    </li>
                                    <li role="separator" class="divider"></li>
                    <li class="dropdown-header"></li>
                    <li class="dropdown dropdown-submenu">
                        <a href='#' class="dropdown-toggle" data-toggle="dropdown"><i class="glyphicon glyphicon-cloud-download"></i> Выгрузить расширенный CSV (OUTCSVEX)</a>
                        <ul class="dropdown-menu">
                            <li><a href='/orc/api/v1/distributives/export?format=CsvEx&amp;version=0' class="fileDownloadPromise">версия 0</a></li>
                            <li><a href='/orc/api/v1/distributives/export?format=CsvEx&amp;version=1' class="fileDownloadPromise">версия 1</a></li>
                        </ul>
                    </li>
                    <li role="separator" class="divider"></li>
                    <li><a href='/orc/api/v1/distributives/export?format=Rgt' class="fileDownloadPromise"><i class="glyphicon glyphicon-cloud-download"></i> Выгрузить RGT-файл</a></li>
                                    <li role="separator" class="divider"></li>
                    <li><a href='/orc/api/v1/regreport/check' class="fileDownloadPromise"><i class="glyphicon glyphicon-cloud-download"></i> Выгрузить чек по РЕГ-отчету</a></li>
            </ul>
        </li>
        <li><a href="/orc/ru-RU/Home/Changelog">Протокол</a></li>

                    </ul>
                    <div class="nav navbar-right navbar-right-patch">


<form action="/orc/ru-RU/Account/LogOff" class="navbar-right" id="logoutForm" method="post"><input name="__RequestVerificationToken" type="hidden" value="jwH8yKkwHtyfDo-GgMQxV-3pm7qrSmHhYtaToicOYfYXWLleBdY1zlekVqTPB4UB0uE98dnmEw6s5_Nict1f9yT94LvECNaQTpK9m40GLwvx7hC6DehetwXHbTMug2MvzIGUkohNBwvB0n0cHhNofA2" />        <ul class="nav navbar-nav navbar-right">
            <li>
                <a><span class="glyphicon glyphicon-user"></span> РИЦ073\ric073bokk </a>
            </li>
            <li><a href="javascript:document.getElementById('logoutForm').submit()">Выйти</a></li>
        </ul>
</form>
                        <form action="/orc/ru-RU/Home/Search" class="navbar-form navbar-left" method="get" role="search">        <div class="input-group">
            <input class="form-control text-box single-line" id="term" maxlength="50" name="term" placeholder="Поиск" type="text" value="" />
            <div class="input-group-btn">
                <button class="btn btn-default" type="submit"><span class="glyphicon glyphicon-search"></span></button>
            </div>
        </div>
</form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container body-content">



<h2 class="page-header">Регистрация <small>изменения</small> </h2>

<div class="panel panel-default">
    <div class="panel-heading">
        <div class="breadcrumb panel-title">
            <span class="text-muted">Запрос </span>
            <span class="text-muted glyphicon glyphicon-chevron-right"></span>
            <strong> Изменения </strong>
            <span class="text-muted glyphicon glyphicon-chevron-right"></span>
            <span class="text-muted"> Результат</span>
        </div>
    </div>
    <div class="panel-body">
            <h4>Содержимое запроса на регистрацию:</h4>
            <ul class="dl-horizontal">
                    <li><a class="markup markup-informationsystem" data-toggle="tooltip" data-placement="top" title="(BUHL) КонсультантБухгалтер: Версия Проф">(BUHL) КонсультантБухгалтер: Версия Проф</a> (<span class="supported"></span><a class="markup-distributive text-primary" href=/orc/Distributive/details/LAW_818097>LAW_818097</a>; &#1090;&#1077;&#1093;&#1085;: <a class="markup markup-techtypeshort" data-toggle="tooltip" data-placement="top" title="оффлайн">оффлайн</a>; &#1089;&#1077;&#1090;: 1; &#1055;&#1045;&#1056;&#1045;&#1053;&#1054;&#1057;)</li>
            </ul>
                    <h4>Регистрация приведет к следующим изменениям:</h4>
        <ul class="dl-horizontal">
                <li>&#1041;&#1091;&#1076;&#1077;&#1090; &#1080;&#1079;&#1084;&#1077;&#1085;&#1105;&#1085; &#1082;&#1086;&#1084;&#1087;&#1083;&#1077;&#1082;&#1090; <span class="supported"></span><a class="markup-kit text-primary" href=/orc/Kit/details/LAW_818097>LAW_818097</a> - &#1040;&#1074;&#1072;&#1085;&#1090;&#1072;&#1078;504404&#1058;&#1077;&#1090;&#1077;&#1088;&#1082;&#1080;&#1085;&#1072;&#1058;&#1072;&#1090;&#1100;&#1103;&#1085;&#1072;&#1042;&#1083;&#1072;&#1076;&#1080;&#1084;&#1080;&#1088;&#1086;&#1074;&#1085;&#1072;:</li>
                <li>&#1041;&#1091;&#1076;&#1077;&#1090; &#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085; &#1087;&#1077;&#1088;&#1077;&#1085;&#1086;&#1089; &#1082;&#1086;&#1084;&#1087;&#1083;&#1077;&#1082;&#1090;&#1072;</li>
                <li><span style="background:yellow">&#1048;&#1079; &#1082;&#1086;&#1084;&#1087;&#1083;&#1077;&#1082;&#1090;&#1072; &#1091;&#1076;&#1072;&#1083;&#1080;&#1090;&#1089;&#1103; &#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1072; <a class="markup markup-informationsystem" data-toggle="tooltip" data-placement="top" title="(STR) КонсультантПлюс: Строительство">(STR) КонсультантПлюс: Строительство</a> (<span class="supported"></span><a class="markup-distributive text-primary" href=/orc/Distributive/details/STR_49560>STR_49560</a>)</span></li>
                <li><span style="background:yellow">&#1048;&#1079; &#1082;&#1086;&#1084;&#1087;&#1083;&#1077;&#1082;&#1090;&#1072; &#1091;&#1076;&#1072;&#1083;&#1080;&#1090;&#1089;&#1103; &#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1072; <a class="markup markup-informationsystem" data-toggle="tooltip" data-placement="top" title="(RLAW073) КонсультантПлюс:РязанскийВыпуск">(RLAW073) КонсультантПлюс:РязанскийВыпуск</a> (<span class="supported"></span><a class="markup-distributive text-primary" href=/orc/Distributive/details/RLAW073_30072>RLAW073_30072</a>)</span></li>
        </ul>
<form action="/orc/ru-RU/Registration/Register" data-bind="submit: doRegistration" id="changesetForm" method="post" onkeydown="return event.keyCode!=13"><input name="__RequestVerificationToken" type="hidden" value="eyIvmlL7iT4b8aSdFoeNrgxKm8AXFi1QUCgYR4unibcLDpSryEclC_Qv56ed1YlhmoEdpsTSjnRknIIs9wsfJs4zz7YK3LAorfwpX1NFIiIqcUqMK3gg70wKj1_PK4zztMYzNtYtypTRaJInc6bI4Q2" />                <div class="form-horizontal">

                    <input id="Id" name="Id" type="hidden" value="4d6463cd-1ca6-4729-b24f-54774c75d8ba" />
                    <input data-val="true" data-val-required="Требуется поле Введите запрос на регистрацию." id="Query" name="Query" type="hidden" value="BUHL818097.QR &lt;143716338033834825129208310264840>" />
                    <input id="FileName" name="FileName" type="hidden" value="" />
                        <div class="form-group">
                            <label class="control-label col-md-2" for="ServicePoint">Комментарий</label>
                            <div class="col-md-10">
                                <select class="form-control select2" data-bind="select2: select2Options, select2Data: select2DataArray" data-val="true" data-val-required="Требуется поле Комментарий." id="ServicePoint" name="ServicePoint" style="width: 100%"><option selected="selected" value="d303edf8-7ce6-4388-9c37-62e206752233">Авантаж504404ТетеркинаТатьянаВладимировна</option>
</select>
                                <span class="field-validation-valid text-danger" data-valmsg-for="ServicePoint" data-valmsg-replace="true"></span>
                                <strong id="servicePointStatus" class="text-danger" data-bind="text: servicePointStatus"></strong>
                            </div>
                        </div>



                        <fieldset class="form-group">
                            <label class="control-label col-md-2" for="IsServicedBySubhost">Обслуживается подхостом</label>
                            <div class="col-md-10 checkbox">
                                <label class="text-muted">
                                    <input id="IsServicedBySubhost" name="IsServicedBySubhost" type="checkbox" value="true" /><input name="IsServicedBySubhost" type="hidden" value="false" />
                                    <span class="field-validation-valid text-danger" data-valmsg-for="IsServicedBySubhost" data-valmsg-replace="true"></span>
                                </label>
                            </div>
                        </fieldset>




                    <hr />
                    <div class="form-group">
                        <div class="col-md-12">
                            <input type="button" value="Назад" class="btn cancel" data-bind="click: goBack, event: {keydown: onEnterPressDoClick}" />
                            <input type="submit" value="Зарегистрировать" class="btn btn-default btn-primary" data-bind="enable: canDoRegister, event: {keydown: onEnterPressDoClick}" />
                        </div>
                    </div>
                </div>
</form>    </div>
</div>


        <hr />
        <footer>
            <p>
                <span>&copy; 2021 Консультант Плюс.</span>
                    <span> Версия: 1.00.00.508863                    </span>
                                    <span>(сервер: e1)</span>
            </p>
        </footer>
    </div>
    <div id="alertModalDialog" class="modal" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header alert" data-bind="css: captionClass">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <span class="glyphicon" data-bind="css: captionIconClass" style="margin-right: 0.5em;"></span>
                    <span class="modal-title" data-bind="text: caption"></span>
                </div>
                <div class="modal-body">
                    <p data-bind="text: message"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
                </div>
            </div>
        </div>
    </div>
    <script src="/orc/bundles/jquery?v=QGNTxAMM6EioOl_euO3qi-3gAJOCA3MDkOlZgYy6PkE1"></script>

    <script src="/orc/bundles/bootstrap?v=j-rYeYvQ4W7YmQPNuyMv0HYa8f6VNS6tvEjRO944tD01"></script>

    <script src="/orc/bundles/fileUpload?v=qhGqBWPxR7bUrsAWarXBEOkE_PTA0TGeRP4YVXJj1241"></script>

    <script src="/orc/bundles/polyfill?v=jt76ouYzxh8PHuSAJ-aaqTniYRULA0xK8wvuei5WxzE1"></script>

    <script src="/orc/bundles/lodash?v=8NiGU-lzxIhNKBWaAm1XVA9Afaxn87XogMXVls5DZjE1"></script>

    <script src="/orc/bundles/fileDownload?v=PsVjvOiGuOYBdrzqezUCJsQ3ZrBucM9l4l9BRUzipmc1"></script>

    <script src="/orc/bundles/knockout?v=rVEy3PGDrh25HyqWEjkDfHBcwSEy2db7ckamaJExMzw1"></script>

    <script src="/orc/bundles/shared?v=0eHT8FQStX7c1BOWO_8o3x-lSsyHH8-tRQMHk2TjSUc1"></script>


    <script type="text/javascript">
    $(document).ready(function () {

        // Change validation messages to be in Russian
        ko.validation.locale('ru-RU');

        // _SearchPartial script
        var input = $('#term');
        input.closest('form').find('button').prop('disabled', true);

        input.bind("change keyup input", function () {
            var empty = _.isEmpty(input.val().toString().trim());
            if (empty) {
                input.closest('form').find('button').prop('disabled', true);
            }
            else {
                var buttons = input.closest('form').find('button');
                if (_.some(buttons, ['disabled', true])) {
                    buttons.prop('disabled', false);
                    buttons.effect('highlight', { color: "#ffffff" });
                }
            }

        }).keyup();

        var alertModalDialogVm = new _cplusOrc.ViewModels.AlertModalDialogViewModel();
        ko.applyBindings(alertModalDialogVm, $('#alertModalDialog').get(0));
        // fileDownload script
        $(document).on("click", "a.fileDownloadPromise", function () {
            $.fileDownload($(this).prop('href'))
                .done(function () {
                    //alert('Файл загружен');
                })
                .fail(function (responseHtml, url, error) {
                    var message = "";
                    if (responseHtml && responseHtml.text) {
                        var error = JSON.parse(responseHtml.text());
                        if (error) {
                            message = error.Error.Message;
                        }
                    }
                    alertModalDialogVm.ShowErrorDialog('Не удалось выгрузить файл', 'Не удалось выгрузить файл. ' + message);
                });

            return false; //this is critical to stop the click event which will trigger a normal file download
        });

        // menu csv Import
        var csvImportElement = $('#csvimport-menu-item').get(0);
        if (csvImportElement) {
            var csvImportVm = new _cplusOrc.ViewModels.FileUploadViewModel(alertModalDialogVm, '#csvimport-menu-file-input', 16777216, '/orc/api/v1/distributives/importResult');
            ko.applyBindings(csvImportVm, csvImportElement);
        }

        // menu dropdowns
        $('li.dropdown-submenu [data-toggle=dropdown]').on('click', function (e) {
            e.stopPropagation();
            e.preventDefault();

            // If a menu is already open we close it
            $('li.dropdown-submenu [data-toggle=dropdown]').parent().removeClass('open');
            $(this).parent().addClass('open');

            var menu = $(this).parent().find("ul");
            var menupos = menu.offset();

            if ((menupos.left + menu.width()) + 30 > $(window).width()) {
                var newpos = - menu.width();
            } else {
                var newpos = $(this).parent().width();
            }
            menu.css({ left:newpos });
        });

    });

</script>

    <script src="/orc/bundles/jqueryval?v=3O_ytaKFJDGC33rm1FVfx-lBqMGs_vM2_-FeKdSCrw01"></script>

    <script src="/orc/bundles/select2?v=P_cATQZJlE-0q07a6rrLUCNDkh5c4dpWP_oN3O7o0do1"></script>

    <script type="text/javascript">

        var ViewModel = function(select2El) {
            var self = this;
            var checkingItem = null;
            var select2LastResult = null;
            var goBack = false;

            self.$select2El = select2El;
            self.select2DataArray = ko.observable();
            self.select2Data = ko.pureComputed(function() {
                return (self.select2DataArray() && self.select2DataArray().length > 0 ? self.select2DataArray()[0] : null);
            });
            self.isNewServicePoint = ko.pureComputed(function() {
                var selectedPoint = self.select2Data();
                if(!selectedPoint || !selectedPoint.id) {
                    return false;
                }
                if(selectedPoint.alreadyExists === false) {
                    return true;
                }
                return false;
            });
            self.phoneNumber = ko.pureComputed(function() {
                var selectedPoint = self.select2Data();
                if(checkingItem) {
                    return '';
                }
                if(selectedPoint) {
                    return selectedPoint.phoneNumber || "";
                }
                return "";
            });
            self.isPhoneNumberRequired = ko.pureComputed(function() {
                var result = false;
                var phoneNumberRequired = false;
                var selectedPoint = self.select2Data();
                if(selectedPoint && selectedPoint.id) {
                    var comment = selectedPoint.text;
                    if(comment) {
                        var isSpecialDemCommentUrl = '/orc/api/v1/registrations/isSpecialDemComment';
                        $.getJSON(isSpecialDemCommentUrl, { comment: comment }, function (data) {
                            if(phoneNumberRequired && !data.value) {
                                result = true;
                            }
                        });
                    }
                }
                return result;
            });
            self.servicePointStatus = ko.pureComputed(function() {
                var selectedPoint = self.select2Data();
                var result = '';
                if(selectedPoint && selectedPoint.id) {
                    if(selectedPoint.alreadyExists === false) {
                        result = 'Введен новый комментарий';
                    } else if(selectedPoint.alreadyExists === true) {
                        result = 'Выбран существующий комментарий';
                    }
                }
                return result;
            });
            self.select2Options = {
                language: "ru",
                allowClear: true, //HOTFIX Вместе с placeholder должно задаваться здесь, иначе не работает.
                placeholder: 'Комментарий\u2026',
                minimumInputLength: 0,
                maximumInputLength: 50,
                tags: "true",
                ajax: {
                    url: '/orc/api/v1/registrations/4d6463cd-1ca6-4729-b24f-54774c75d8ba/points',
                    delay: 250,
                    dataType: "json",
                    data: function (params) {
                        return { comment: params.term, page: params.page || 1 };
                    },
                    processResults: function (data, params) {
                        var search = self.$select2El.data('select2').dropdown.$search;
                        if(search && search.val() !== params.term && select2LastResult) {
                        }
                        else {
                            select2LastResult = {
                                results: $.map(data.Rows, function (item) {
                                    return { text: item.Comment, id: item.Id, phoneNumber: item.PhoneNumber, alreadyExists: true };
                                }),
                                pagination: { more: data.More }
                            };
                        }

                        return select2LastResult;
                    }
                },
                templateResult: function (e) {
                    if(e.alreadyExists === false)
                    {
                        return $('<span>' + e.text + '   <strong class="text-danger">новый</strong></span>');
                    }

                    return e.text;
                },
                templateSelection: function (e) {
                    if(e.id && typeof e.alreadyExists !== 'boolean') {
                        return $('<span>' + e.text + '   <strong class="text-danger">...</strong></span>');
                    } else if(e.alreadyExists === false) {
                        return $('<span>' + e.text + '   <strong class="text-danger">новый</strong></span>');
                    }

                    return e.text;
                },
                createTag: function (tag) {
                    var term = tag.term;
                    if (term === '') {
                        return null;
                    }

                    var search = self.$select2El.data('select2').dropdown.$search;
                    if(search && search.val() !== term) {
                        return null;
                    }

                    return {
                        id: term,
                        text: term,
                        alreadyExists: false
                    };
                }
            };

            this.checkComment = function() {
                var currentItem = self.select2Data();
                if(!currentItem || typeof currentItem.alreadyExists === 'boolean') {
                    return;
                }
                if(checkingItem && checkingItem.text === currentItem.text) {
                    return;
                } else {
                    checkingItem = currentItem;
                }
                $.ajax({
                    url: '/orc/api/v1/registrations/4d6463cd-1ca6-4729-b24f-54774c75d8ba/point',
                    dataType: 'json',
                    data: { comment: currentItem.text }
                })
                .done(function(data) {
                    var itemData = self.select2Data();
                    if(itemData && itemData.id === currentItem.id) {
                        var option = $('<option></option>')
                            .attr('value', itemData.id)
                          .attr('selected', true)
                          .text(itemData.text)
                          .appendTo(self.$select2El.find('option').remove().end());
                        self.$select2El.trigger('change');
                        option.data().data['alreadyExists'] = (data ? true : false);
                        self.$select2El.trigger('change');
                    }
                })
                .always(function() {
                    checkingItem = null;
                });
            };

            this.select2Data.subscribe(function(value) {
                self.checkComment();
            });

            this.registrationInProgress = ko.observable(false);

            this.canDoRegister = ko.pureComputed(function() {
                return !self.registrationInProgress();
            });

            this.doRegistration = function(elem) {
                if(!goBack && !self.registrationInProgress()) {
                    if($(elem).valid()) {
                        self.registrationInProgress(true);
                        $(elem).submit();
                    }
                }
                else {
                    return true;
                }
            };

            this.onEnterPressDoClick = function(data, event) {
                if(event.keyCode != 13) {
                    return true;
                }
                else {
                    $(event.target).trigger('click');
                }
            };

            this.goBack = function(data, event) {
                var form = $(event.target).closest('form');
                form.append('<input type="hidden" name="Back" value="true" />');
                goBack = true;
                form.submit();
            };

        };

        var GoBackViewModel = function() {
            var self = this;

            this.goBack = function(elem) {
                var form = $(elem);
                form.append('<input type="hidden" name="Back" value="true" />');
                return true;
            };
        };


        $(document).ready(function () {

            var vmTarget = $('#changesetForm');
            if(vmTarget.length > 0) {
                var vm = new ViewModel($('#ServicePoint'));
                ko.applyBindings(vm, vmTarget[0]);
            }
            else {
                var goBackForm = $('#goBackOnErrorForm');
                if(goBackForm.length > 0) {
                    var vm = new GoBackViewModel();
                    ko.applyBindings(vm, goBackForm[0]);
                }
            }

        });
    </script>


</body>
</html>
